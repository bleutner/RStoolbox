<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fractional Cover Analysis — fCover • RStoolbox</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fractional Cover Analysis — fCover"><meta name="description" content="fCover takes a classified high resolution image, e.g. vegetation and non-vegetation based on Landsat and calculates cover fractions for
pixels of a coarser resolution, e.g. MODIS."><meta property="og:description" content="fCover takes a classified high resolution image, e.g. vegetation and non-vegetation based on Landsat and calculates cover fractions for
pixels of a coarser resolution, e.g. MODIS."><meta property="og:image" content="https://bleutner.github.io/RStoolbox/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RStoolbox</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="http://www.github.com/bleutner"><span class="fa fa-github fa-lg fab"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fractional Cover Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/bleutner/RStoolbox/blob/master/R/fCover.R" class="external-link"><code>R/fCover.R</code></a></small>
      <div class="d-none name"><code>fCover.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>fCover takes a classified high resolution image, e.g. vegetation and non-vegetation based on Landsat and calculates cover fractions for
pixels of a coarser resolution, e.g. MODIS.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fCover</span><span class="op">(</span></span>
<span>  <span class="va">classImage</span>,</span>
<span>  <span class="va">predImage</span>,</span>
<span>  nSamples <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  classes <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  maxNA <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  clamp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"rf"</span>,</span>
<span>  tuneLength <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  filename <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">verbose</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-classimage">classImage<a class="anchor" aria-label="anchor" href="#arg-classimage"></a></dt>
<dd><p>high resolution SpatRaster containing a landcover classification, e.g. as obtained by <a href="superClass.html">superClass</a>.</p></dd>


<dt id="arg-predimage">predImage<a class="anchor" aria-label="anchor" href="#arg-predimage"></a></dt>
<dd><p>coarse resolution SpatRaster for which fractional cover will be estimated.</p></dd>


<dt id="arg-nsamples">nSamples<a class="anchor" aria-label="anchor" href="#arg-nsamples"></a></dt>
<dd><p>Integer. Number of pixels to sample from predImage to train the regression model</p></dd>


<dt id="arg-classes">classes<a class="anchor" aria-label="anchor" href="#arg-classes"></a></dt>
<dd><p>Integer. Classes for which fractional cover should be estimated (one or more).</p></dd>


<dt id="arg-maxna">maxNA<a class="anchor" aria-label="anchor" href="#arg-maxna"></a></dt>
<dd><p>Numeric. Maximal proportion of NAs allowed in training pixels.</p></dd>


<dt id="arg-clamp">clamp<a class="anchor" aria-label="anchor" href="#arg-clamp"></a></dt>
<dd><p>Logical. Enforce results to stay within [0,1] interval. Values &lt;0 are reset to 0 and values &gt;1 to 1.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Character. Which model to fit for image regression. See <a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a> for options. Defaults to randomForest ('rf')</p></dd>


<dt id="arg-tunelength">tuneLength<a class="anchor" aria-label="anchor" href="#arg-tunelength"></a></dt>
<dd><p>Integer. Number of levels for each tuning parameters that should be generated by train. See Details and <code><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></code>.</p></dd>


<dt id="arg-trcontrol">trControl<a class="anchor" aria-label="anchor" href="#arg-trcontrol"></a></dt>
<dd><p><code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></code> object, specifying resampling, validation etc.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>DEPREACTED! in favor of <code>trControl=trainControl(method="cv")</code> Resampling method for parameter tuning. Defaults to 10 fold cross-validation. See <code><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></code> for options.</p></dd>


<dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p>Character. Filename of the output raster file (optional).</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical. if <code>TRUE</code>, <code>filename</code> will be overwritten.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print progress information.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments to be passed to  <code><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list with two elements: models contains the fitted models evaluated in tenfold cross-validation (caret train objects);
fCover contains a SpatRaster with a fractional cover layer for each requested class.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>fCover gets the pixel values in a high resolution classified image that correspond to
randomly selected moderate resolution pixels and then calculates the percent of
the classified image pixels that represent your cover type of interest. In other words, if
your high resolution image has a pixel size of 1m and your moderate resolution image has a
pixel size of 30m the sampling process would take a block of 900 of the 1m resolution pixels
that correspond to a single 30m pixel and calculate the percentage of the 1m pixels that
are forest. For example, if there were 600 forest pixels and 300 non-forest pixels the value
given for the output pixel would be 0.67 since 67<!-- % of the block of 1m pixels were forest.  --></p>
<p>fCover relies on the train() function from the caret package which provides access to a huge number of classifiers.
Please see the available options at <a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a>. The default classifier (randomForest) we chose has been shown
to provide very good results in image regression and hence it is recomended you start with this one. If you choose a different
classifier, make sure it can run in regression mode.</p>
<p>Many models require tuning of certain parameters. Again, this is handled by <a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a> from the caret package.
With the tuneLength argument you can specify how many different values of each tuning parameter should be tested. The Random Forest
algorithm for example can be tuned by varying the mtry parameter. Hence, by specifying tuneLength = 10, ten different levels
of mtry will be tested in a cross-validation scheme and the best-performing value will be chosen for the final model.</p>

<p>If the total no-data values for a block of high resolution pixels is greater than maxNA then
it will not be included in the training data set since there is too much missing data to provide
a reliable cover percentage. If the no-data proporton is less then maxNA the no-data pixels are removed
from the total number of pixels when calculating the percent cover.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="superClass.html">superClass</a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: lattice</span>
<span class="r-in"><span><span class="co">## Create fake input images</span></span></span>
<span class="r-in"><span><span class="va">agg.level</span> <span class="op">&lt;-</span> <span class="fl">9</span></span></span>
<span class="r-in"><span><span class="va">modis</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">rlogo</span>, <span class="va">agg.level</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Perform an exemplary classification</span></span></span>
<span class="r-in"><span><span class="va">lc</span>      <span class="op">&lt;-</span> <span class="fu"><a href="unsuperClass.html">unsuperClass</a></span><span class="op">(</span><span class="va">rlogo</span>, nClass<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Calculate the true cover, which is of course only possible in this example, </span></span></span>
<span class="r-in"><span><span class="co">## because the fake corse resolution imagery is exactly res(rlogo)*9</span></span></span>
<span class="r-in"><span><span class="va">trueCover</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">lc</span><span class="op">$</span><span class="va">map</span>, <span class="va">agg.level</span>, </span></span>
<span class="r-in"><span>                   fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">...</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run with randomForest and support vector machine (radial basis kernel)</span></span></span>
<span class="r-in"><span><span class="co">## Of course the SVM is handicapped in this example,</span></span></span>
<span class="r-in"><span><span class="co">## due to poor tuning (tuneLength)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">model</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rf"</span>, <span class="st">"svmRadial"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu">fCover</span><span class="op">(</span></span></span>
<span class="r-in"><span>           classImage <span class="op">=</span> <span class="va">lc</span><span class="op">$</span><span class="va">map</span> ,</span></span>
<span class="r-in"><span>           predImage <span class="op">=</span> <span class="va">modis</span>,</span></span>
<span class="r-in"><span>           classes<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>           trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           model<span class="op">=</span><span class="va">model</span>,</span></span>
<span class="r-in"><span>           nSample <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>           tuneLength<span class="op">=</span><span class="fl">2</span></span></span>
<span class="r-in"><span>   <span class="op">)</span>           </span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="co">## How close is it to the truth?</span></span></span>
<span class="r-in"><span>   <span class="va">compare.rf</span> <span class="op">&lt;-</span> <span class="va">trueCover</span> <span class="op">-</span> <span class="va">fc</span><span class="op">$</span><span class="va">map</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fc</span><span class="op">$</span><span class="va">map</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Fractional Cover: Class 1\nModel:"</span>, <span class="va">model</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">compare.rf</span>, main <span class="op">=</span> <span class="st">"Diffence\n true vs. predicted"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trueCover</span><span class="op">[</span><span class="op">]</span>,<span class="va">fc</span><span class="op">$</span><span class="va">map</span><span class="op">[</span><span class="op">]</span>,  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           xlab <span class="op">=</span> <span class="st">"True Cover"</span>, ylab <span class="op">=</span> <span class="st">"Predicted Cover"</span> <span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>coef<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">rmse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">global</a></span><span class="op">(</span><span class="va">compare.rf</span><span class="op">^</span><span class="fl">2</span>, <span class="st">"sum"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">compare.rf</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">trueCover</span><span class="op">[</span><span class="op">]</span>, <span class="va">fc</span><span class="op">$</span><span class="va">map</span><span class="op">[</span><span class="op">]</span>, <span class="st">"complete.obs"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.1</span>, adj<span class="op">=</span><span class="fl">1</span>, labels <span class="op">=</span> </span></span>
<span class="r-in"><span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RMSE:"</span>,<span class="st">"\nR2:"</span><span class="op">)</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">rmse</span>, <span class="va">r2</span><span class="op">)</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="fCover-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Reset par</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin Leutner, Ned Horning, Jakob Schwalb-Willmann, Konstantin Mueller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

